{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\nvar tslib = require('tslib');\nvar React = require('react');\nvar React__default = _interopDefault(React);\nvar js = require('@frontegg/js');\nvar reactHooks = require('@frontegg/react-hooks');\nvar ReactRouterDom = require('react-router-dom');\nvar restApi = require('@frontegg/rest-api');\nvar AppHolder = require('@frontegg/js/AppHolder');\nvar ReactDOM = _interopDefault(require('react-dom'));\nvar reactIs = require('react-is');\nvar types = require('@frontegg/types');\nvar BrowserRouter = ReactRouterDom.BrowserRouter;\nvar useHistory = function () {\n  var _a, _b, _c;\n  // @ts-ignore\n  var navigate = ((_a = ReactRouterDom.useInRouterContext) === null || _a === void 0 ? void 0 : _a.call(ReactRouterDom)) ? (_b = ReactRouterDom.useNavigate) === null || _b === void 0 ? void 0 : _b.call(ReactRouterDom) : null;\n  var history = (_c = ReactRouterDom.useHistory) === null || _c === void 0 ? void 0 : _c.call(ReactRouterDom);\n  if (navigate) {\n    var push = function (path, state) {\n      if (state) {\n        navigate(path, {\n          state: state\n        });\n      } else {\n        navigate(path);\n      }\n    };\n    var replace = function (path, state) {\n      navigate(path, {\n        state: state,\n        replace: true\n      });\n    };\n    return {\n      push: push,\n      replace: replace\n    };\n  }\n  return history;\n};\nvar removeRedirectUrlFromQuery = function (query) {\n  var q = new URLSearchParams(query);\n  q.delete('redirectUrl');\n  return q.toString();\n};\nvar useQueryKeeper = function (_a) {\n  var routes = _a.routes,\n    history = _a.history;\n  var queryParams = React.useRef();\n  var prevPathname = React.useRef();\n  var _b = ReactRouterDom.useLocation(),\n    pathname = _b.pathname,\n    search = _b.search;\n  React.useEffect(function () {\n    if (!!search) {\n      queryParams.current = search;\n      prevPathname.current = pathname;\n    }\n  }, []);\n  React.useEffect(function () {\n    var shouldKeepQuery = !!Object.values(routes).find(function (route) {\n      return route === prevPathname.current;\n    });\n    if (!search && !!queryParams.current && shouldKeepQuery) {\n      var query = removeRedirectUrlFromQuery(queryParams.current);\n      history.push(pathname + (\"?\" + query));\n    }\n    prevPathname.current = pathname;\n  }, [pathname, search, routes]);\n};\nvar CustomComponentHolder = /** @class */function () {\n  function CustomComponentHolder() {}\n  CustomComponentHolder.set = function (name, element) {\n    CustomComponentHolder.components[name] = element;\n  };\n  CustomComponentHolder.get = function (name) {\n    return CustomComponentHolder.components[name];\n  };\n  CustomComponentHolder.components = {};\n  return CustomComponentHolder;\n}();\nvar overrideValue = function (object, key, value) {\n  var keys = key.split('.');\n  var iterator = object;\n  while (keys.length > 1) {\n    iterator = iterator[keys.shift()];\n  }\n  iterator[keys.shift()] = value;\n};\nvar Registerer = function (props) {\n  var _a, _b;\n  var app = props.app,\n    themeKey = props.themeKey;\n  var value = CustomComponentHolder.get(themeKey);\n  var _c = React.useState(false),\n    mounted = _c[0],\n    setMounted = _c[1];\n  var mount = React.useCallback(function () {\n    setMounted(true);\n  }, []);\n  var unmount = React.useCallback(function () {\n    setMounted(false);\n  }, []);\n  overrideValue(app.options.themeOptions, themeKey, {\n    type: 'slot',\n    themeKey: themeKey,\n    mount: mount,\n    unmount: unmount\n  });\n  var element = (_a = app.loginBoxContainer) === null || _a === void 0 ? void 0 : _a.querySelector(\"[slot=\\\"\" + themeKey + \"\\\"]\");\n  if (!element && typeof document !== undefined) {\n    element = document.createElement('div');\n    element.slot = themeKey;\n    (_b = app.loginBoxContainer) === null || _b === void 0 ? void 0 : _b.appendChild(element);\n  }\n  return element && mounted ? React__default.createElement(React__default.Fragment, null, ReactDOM.createPortal(value, element)) : React__default.createElement(React__default.Fragment, null);\n};\nvar CustomComponentRegister = function (_a) {\n  var app = _a.app,\n    themeOptions = _a.themeOptions;\n  var keys = React.useMemo(function () {\n    if (!themeOptions || !themeOptions.loginBox) {\n      return [];\n    }\n    var loop = function (key, obj, keyPath) {\n      if (typeof obj !== 'object' && typeof obj !== 'function') {\n        return [];\n      }\n      if (typeof obj === 'function') {\n        try {\n          obj = React__default.createElement(obj);\n          if (React.isValidElement(obj) || reactIs.isElement(obj)) {\n            var generatedKey = keyPath + \".\" + key;\n            CustomComponentHolder.set(generatedKey, obj);\n            return [generatedKey];\n          }\n        } catch (e) {}\n      }\n      if (React.isValidElement(obj) || reactIs.isElement(obj)) {\n        var generatedKey = keyPath + \".\" + key;\n        CustomComponentHolder.set(generatedKey, obj);\n        return [generatedKey];\n      } else {\n        var elements_1 = [];\n        Object.keys(obj).forEach(function (k) {\n          elements_1.push.apply(elements_1, loop(k, obj[k], keyPath === '' ? key : keyPath + \".\" + key));\n        });\n        return elements_1;\n      }\n    };\n    return loop('loginBox', themeOptions.loginBox, '');\n  }, []);\n  return React__default.createElement(React__default.Fragment, null, keys.map(function (key) {\n    return React__default.createElement(Registerer, {\n      key: key,\n      app: app,\n      themeKey: key\n    });\n  }));\n};\nvar ConnectorHistory = function (props) {\n  var history = useHistory();\n  return React__default.createElement(Connector, tslib.__assign({\n    history: history\n  }, props));\n};\nvar Connector = function (_a) {\n  var _b;\n  var history = _a.history,\n    appName = _a.appName,\n    props = tslib.__rest(_a, [\"history\", \"appName\"]);\n  var isSSR = typeof window === 'undefined';\n  // v6 or v5\n  var baseName = (_b = props.basename) !== null && _b !== void 0 ? _b : '';\n  var onRedirectTo = React.useCallback(function (_path, opts) {\n    var path = _path;\n    // noinspection SuspiciousTypeOfGuard\n    if (baseName && typeof baseName === 'string' && baseName.length > 0 && path.startsWith(baseName)) {\n      path = path.substring(baseName.length);\n    }\n    if (opts === null || opts === void 0 ? void 0 : opts.preserveQueryParams) {\n      path = \"\" + path + window.location.search;\n    }\n    if ((opts === null || opts === void 0 ? void 0 : opts.refresh) && !isSSR) {\n      // @ts-ignore\n      window.Cypress ? history.push(path) : window.location.href = path;\n    } else {\n      (opts === null || opts === void 0 ? void 0 : opts.replace) ? history.replace(path) : history.push(path);\n    }\n  }, []);\n  var app = React.useMemo(function () {\n    var _a;\n    try {\n      return AppHolder.AppHolder.getInstance(appName !== null && appName !== void 0 ? appName : 'default');\n    } catch (e) {\n      return js.initialize(tslib.__assign(tslib.__assign({}, props), {\n        basename: (_a = props.basename) !== null && _a !== void 0 ? _a : baseName,\n        contextOptions: tslib.__assign({\n          requestCredentials: 'include'\n        }, props.contextOptions),\n        onRedirectTo: onRedirectTo\n      }), appName !== null && appName !== void 0 ? appName : 'default');\n    }\n  }, []);\n  restApi.ContextHolder.setOnRedirectTo(onRedirectTo);\n  var signUpUrl = app.store.getState().auth.routes.signUpUrl;\n  useQueryKeeper({\n    routes: {\n      signUpUrl: signUpUrl\n    },\n    history: history\n  });\n  return React__default.createElement(React__default.Fragment, null, React__default.createElement(CustomComponentRegister, {\n    app: app,\n    themeOptions: props.themeOptions\n  }), React__default.createElement(reactHooks.FronteggStoreProvider, tslib.__assign({}, tslib.__assign(tslib.__assign({}, props), {\n    app: app\n  }))));\n};\nvar FronteggProvider = function (props) {\n  var history = useHistory();\n  if (props.history || history) {\n    return React__default.createElement(Connector, tslib.__assign({\n      history: props.history || history\n    }, props), props.children);\n  }\n  return React__default.createElement(BrowserRouter, {\n    basename: props.basename\n  }, React__default.createElement(ConnectorHistory, tslib.__assign({}, props), props.children));\n};\nvar AuthorizedContent = function (props) {\n  var _a, _b;\n  var isAuthorized = true; // Initially\n  var user = reactHooks.useAuthUserOrNull();\n  if (!(user === null || user === void 0 ? void 0 : user.superUser)) {\n    if (props.requiredPermissions) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching permission\n      var _loop_1 = function (permission) {\n        if ((_a = user === null || user === void 0 ? void 0 : user.permissions) === null || _a === void 0 ? void 0 : _a.find(function (_a) {\n          var key = _a.key;\n          return key === permission;\n        })) {\n          isAuthorized = true;\n        }\n      };\n      for (var _i = 0, _c = props.requiredPermissions; _i < _c.length; _i++) {\n        var permission = _c[_i];\n        _loop_1(permission);\n      }\n    }\n    if (props.requiredRoles) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching role\n      var _loop_2 = function (role) {\n        if ((_b = user === null || user === void 0 ? void 0 : user.roles) === null || _b === void 0 ? void 0 : _b.find(function (_a) {\n          var key = _a.key;\n          return key === role;\n        })) {\n          isAuthorized = true;\n        }\n      };\n      for (var _d = 0, _e = props.requiredRoles; _d < _e.length; _d++) {\n        var role = _e[_d];\n        _loop_2(role);\n      }\n    }\n  }\n  if (typeof props.render === 'function') {\n    return React__default.createElement(React__default.Fragment, null, props.render(isAuthorized));\n  }\n  return isAuthorized ? React__default.createElement(React__default.Fragment, null, props.children) : null;\n};\nvar useCheckoutDialog = function (appName) {\n  if (appName === void 0) {\n    appName = 'default';\n  }\n  var _a = React.useState({\n      open: false,\n      error: null,\n      success: false\n    }),\n    _b = _a[0],\n    open = _b.open,\n    error = _b.error,\n    success = _b.success,\n    setState = _a[1];\n  var handleError = React.useCallback(function (error) {\n    setState({\n      open: true,\n      success: false,\n      error: error\n    });\n  }, []);\n  var handleSuccess = React.useCallback(function () {\n    setState({\n      open: false,\n      success: true,\n      error: null\n    });\n  }, []);\n  var showDialog = React.useCallback(function (plan) {\n    js.CheckoutDialog.show({\n      plan: plan,\n      onClose: hideDialog,\n      onError: handleError,\n      onSuccess: handleSuccess\n    }, appName);\n    setState({\n      open: true,\n      success: false,\n      error: null\n    });\n  }, [appName]);\n  var hideDialog = React.useCallback(function () {\n    js.CheckoutDialog.hide(appName);\n    setState({\n      open: false,\n      error: null,\n      success: false\n    });\n  }, [appName]);\n  return React.useMemo(function () {\n    return {\n      open: open,\n      showDialog: showDialog,\n      hideDialog: hideDialog,\n      error: error,\n      success: success\n    };\n  }, [open, showDialog, hideDialog, error, success]);\n};\nObject.keys(reactHooks).forEach(function (k) {\n  if (k !== 'default') Object.defineProperty(exports, k, {\n    enumerable: true,\n    get: function () {\n      return reactHooks[k];\n    }\n  });\n});\nObject.keys(types).forEach(function (k) {\n  if (k !== 'default') Object.defineProperty(exports, k, {\n    enumerable: true,\n    get: function () {\n      return types[k];\n    }\n  });\n});\nObject.defineProperty(exports, 'AdminPortal', {\n  enumerable: true,\n  get: function () {\n    return js.AdminPortal;\n  }\n});\nObject.defineProperty(exports, 'CheckoutDialog', {\n  enumerable: true,\n  get: function () {\n    return js.CheckoutDialog;\n  }\n});\nObject.defineProperty(exports, 'HostedLogin', {\n  enumerable: true,\n  get: function () {\n    return js.HostedLogin;\n  }\n});\nObject.defineProperty(exports, 'ContextHolder', {\n  enumerable: true,\n  get: function () {\n    return restApi.ContextHolder;\n  }\n});\nexports.AuthorizedContent = AuthorizedContent;\nexports.Connector = Connector;\nexports.ConnectorHistory = ConnectorHistory;\nexports.FronteggProvider = FronteggProvider;\nexports.useCheckoutDialog = useCheckoutDialog;","map":{"version":3,"mappings":"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","names":["BrowserRouter","ReactRouterDom.BrowserRouter","useHistory","navigate","ReactRouterDom","ReactRouterDom.useNavigate","history","ReactRouterDom.useHistory","push","path","state","replace","removeRedirectUrlFromQuery","query","q","URLSearchParams","delete","toString","useQueryKeeper","_a","routes","queryParams","useRef","prevPathname","useLocation","pathname","search","useEffect","current","shouldKeepQuery","Object","values","find","route","CustomComponentHolder","name","element","components","overrideValue","object","key","value","keys","split","iterator","length","shift","Registerer","props","themeKey","get","useState","mounted","setMounted","mount","useCallback","unmount","app","options","themeOptions","type","loginBoxContainer","querySelector","document","undefined","createElement","slot","appendChild","React","Fragment","ReactDOM","createPortal","CustomComponentRegister","useMemo","loginBox","loop","obj","keyPath","isValidElement","isElement","generatedKey","set","e","elements_1","forEach","k","map","ConnectorHistory","Connector","appName","isSSR","window","baseName","basename","onRedirectTo","_path","opts","startsWith","substring","preserveQueryParams","location","refresh","Cypress","href","AppHolder","getInstance","initialize","contextOptions","requestCredentials","ContextHolder","setOnRedirectTo","signUpUrl","store","getState","auth","FronteggStoreProvider","__assign","FronteggProvider","children","AuthorizedContent","isAuthorized","user","useAuthUserOrNull","superUser","requiredPermissions","permission","permissions","_c","_i","requiredRoles","role","roles","_e","_d","render","useCheckoutDialog","open","error","success","_b","setState","handleError","handleSuccess","showDialog","plan","CheckoutDialog","show","onClose","hideDialog","onError","onSuccess","hide"],"sources":["/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/routerProxy.tsx","/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/queryKeeper.tsx","/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/CustomComponentHolder.tsx","/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/FronteggProvider.tsx","/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/AuthorizedContent.tsx","/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/src/CheckoutDialog.tsx"],"sourcesContent":["import * as ReactRouterDom from 'react-router-dom';\nimport { FC } from 'react';\nimport { BrowserRouterProps } from 'react-router-dom';\n\nexport type Path = string;\n\ntype Location = {\n  pathname: string;\n  search: string;\n  state: any;\n  hash: string;\n  key?: string;\n};\n\ntype LocationDescriptor = string | Location;\n\nexport type UseHistory = {\n  push(path: Path, state?: any): void;\n  push(location: LocationDescriptor): void;\n  replace(path: Path, state?: any): void;\n  replace(location: LocationDescriptor): void;\n};\n\nexport const BrowserRouter: FC<BrowserRouterProps> = (ReactRouterDom.BrowserRouter as unknown) as FC<\n  BrowserRouterProps\n>;\n\nexport const useHistory = (): UseHistory => {\n  // @ts-ignore\n  const navigate = ReactRouterDom.useInRouterContext?.() ? ReactRouterDom.useNavigate?.() : null;\n  const history = ReactRouterDom.useHistory?.();\n\n  if (navigate) {\n    const push = (path: Path, state?: any): void => {\n      if (state) {\n        navigate(path, { state });\n      } else {\n        navigate(path);\n      }\n    };\n\n    const replace = (path: Path, state?: any): void => {\n      navigate(path, { state, replace: true });\n    };\n\n    return { push, replace };\n  }\n  return history;\n};\n","import { useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { UseHistory } from './routerProxy';\n\ninterface UseQueryKeeperProps {\n  history: UseHistory;\n  routes: {\n    [key: string]: string;\n  };\n}\n\nconst removeRedirectUrlFromQuery = (query: string) => {\n  const q = new URLSearchParams(query);\n  q.delete('redirectUrl');\n  return q.toString();\n};\n\nexport const useQueryKeeper = ({ routes, history }: UseQueryKeeperProps): void => {\n  const queryParams = useRef<string>();\n  const prevPathname = useRef<string>();\n  const { pathname, search } = useLocation();\n\n  useEffect(() => {\n    if (!!search) {\n      queryParams.current = search;\n      prevPathname.current = pathname;\n    }\n  }, []);\n\n  useEffect(() => {\n    const shouldKeepQuery = !!Object.values(routes).find((route) => route === prevPathname.current);\n\n    if (!search && !!queryParams.current && shouldKeepQuery) {\n      const query = removeRedirectUrlFromQuery(queryParams.current);\n      history.push(pathname + `?${query}`);\n    }\n\n    prevPathname.current = pathname;\n  }, [pathname, search, routes]);\n};\n","import React, { FC, isValidElement, ReactElement, useCallback, useMemo, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { FronteggAppInstance } from '@frontegg/types';\nimport { isElement } from 'react-is';\n\nexport class CustomComponentHolder {\n  private static components: { [name in string]: ReactElement } = {};\n\n  public static set(name: string, element: any) {\n    CustomComponentHolder.components[name] = element;\n  }\n\n  public static get(name: string): ReactElement {\n    return CustomComponentHolder.components[name];\n  }\n}\n\nconst overrideValue = (object: any, key: string, value: any) => {\n  const keys: string[] = key.split('.');\n  let iterator = object;\n  while (keys.length > 1) {\n    iterator = iterator[keys.shift() as any];\n  }\n  iterator[keys.shift() as any] = value;\n};\nconst Registerer: FC<{ app: FronteggAppInstance; themeKey: string }> = (props) => {\n  const { app, themeKey } = props;\n  const value = CustomComponentHolder.get(themeKey);\n  const [mounted, setMounted] = useState(false);\n\n  const mount = useCallback(() => {\n    setMounted(true);\n  }, []);\n  const unmount = useCallback(() => {\n    setMounted(false);\n  }, []);\n\n  overrideValue(app.options.themeOptions!, themeKey, { type: 'slot', themeKey, mount, unmount });\n\n  let element = app.loginBoxContainer?.querySelector(`[slot=\"${themeKey}\"]`);\n  if (!element && typeof document !== undefined) {\n    element = document.createElement('div');\n    element.slot = themeKey;\n    app.loginBoxContainer?.appendChild(element);\n  }\n\n  return element && mounted ? <React.Fragment>{ReactDOM.createPortal(value, element)}</React.Fragment> : <></>;\n};\n\nexport const CustomComponentRegister: FC<{ app: FronteggAppInstance; themeOptions: any }> = ({ app, themeOptions }) => {\n  const keys = useMemo(() => {\n    if (!themeOptions || !themeOptions.loginBox) {\n      return [];\n    }\n    const loop = (key: string, obj: any, keyPath: string): string[] => {\n      if (typeof obj !== 'object' && typeof obj !== 'function') {\n        return [];\n      }\n      if (typeof obj === 'function') {\n        try {\n          obj = React.createElement(obj);\n          if (isValidElement(obj) || isElement(obj)) {\n            const generatedKey = `${keyPath}.${key}`;\n            CustomComponentHolder.set(generatedKey, obj);\n            return [generatedKey];\n          }\n        } catch (e) {}\n      }\n      if (isValidElement(obj) || isElement(obj)) {\n        const generatedKey = `${keyPath}.${key}`;\n        CustomComponentHolder.set(generatedKey, obj);\n        return [generatedKey];\n      } else {\n        const elements: string[] = [];\n        Object.keys(obj).forEach((k) => {\n          elements.push(...loop(k, obj[k], keyPath === '' ? key : `${keyPath}.${key}`));\n        });\n        return elements;\n      }\n    };\n    return loop('loginBox', themeOptions.loginBox, '');\n  }, []);\n\n  return (\n    <>\n      {keys.map((key) => (\n        <Registerer key={key} app={app} themeKey={key} />\n      ))}\n    </>\n  );\n};\n","import React, { FC, ReactNode, useCallback, useMemo } from 'react';\nimport { initialize } from '@frontegg/js';\nimport { FronteggAppOptions } from '@frontegg/types';\nimport { FronteggStoreProvider } from '@frontegg/react-hooks';\nimport { BrowserRouter, useHistory, UseHistory } from './routerProxy';\nimport { ContextHolder, RedirectOptions } from '@frontegg/rest-api';\nimport { AppHolder } from '@frontegg/js/AppHolder';\nimport { useQueryKeeper } from './queryKeeper';\nimport { CustomComponentRegister } from './CustomComponentHolder';\n\nexport type FronteggProviderProps = FronteggAppOptions & {\n  appName?: string;\n  history?: UseHistory;\n  children?: ReactNode;\n};\ntype ConnectorProps = Omit<FronteggProviderProps, 'history'> & {\n  history: {\n    push: (path: string) => void;\n    replace: (path: string) => void;\n  };\n};\n\nexport const ConnectorHistory: FC<Omit<ConnectorProps, 'history'>> = (props) => {\n  const history = useHistory();\n  return <Connector history={history} {...props} />;\n};\n\nexport const Connector: FC<ConnectorProps> = ({ history, appName, ...props }) => {\n  const isSSR = typeof window === 'undefined';\n\n  // v6 or v5\n  const baseName = props.basename ?? '';\n\n  const onRedirectTo = useCallback((_path: string, opts?: RedirectOptions) => {\n    let path = _path;\n    // noinspection SuspiciousTypeOfGuard\n    if (baseName && typeof baseName === 'string' && baseName.length > 0 && path.startsWith(baseName)) {\n      path = path.substring(baseName.length);\n    }\n    if (opts?.preserveQueryParams) {\n      path = `${path}${window.location.search}`;\n    }\n    if (opts?.refresh && !isSSR) {\n      // @ts-ignore\n      window.Cypress ? history.push(path) : (window.location.href = path);\n    } else {\n      opts?.replace ? history.replace(path) : history.push(path);\n    }\n  }, []);\n\n  const app = useMemo(() => {\n    try {\n      return AppHolder.getInstance(appName ?? 'default');\n    } catch (e) {\n      return initialize(\n        {\n          ...props,\n          basename: props.basename ?? baseName,\n          contextOptions: {\n            requestCredentials: 'include',\n            ...props.contextOptions,\n          },\n          onRedirectTo,\n        },\n        appName ?? 'default'\n      );\n    }\n  }, []);\n  ContextHolder.setOnRedirectTo(onRedirectTo);\n\n  const signUpUrl = app.store.getState().auth.routes.signUpUrl;\n  useQueryKeeper({ routes: { signUpUrl }, history });\n\n  return (\n    <>\n      <CustomComponentRegister app={app} themeOptions={props.themeOptions} />\n      <FronteggStoreProvider {...({ ...props, app } as any)} />\n    </>\n  );\n};\n\nexport const FronteggProvider: FC<FronteggProviderProps> = (props) => {\n  const history = useHistory();\n\n  if (props.history || history) {\n    return (\n      <Connector history={props.history || history} {...props}>\n        {props.children}\n      </Connector>\n    );\n  }\n\n  return (\n    <BrowserRouter basename={props.basename}>\n      <ConnectorHistory {...props}>{props.children}</ConnectorHistory>\n    </BrowserRouter>\n  );\n};\n","import React, { FC, ReactNode } from 'react';\nimport { useAuthUserOrNull } from '@frontegg/react-hooks';\n\nexport interface AuthorizationProps {\n  requiredRoles?: string[];\n  requiredPermissions?: string[];\n  render?: (isAuthorized: boolean) => React.ReactNode | null;\n  children?: ReactNode;\n}\n\nexport const AuthorizedContent: FC<AuthorizationProps> = (props) => {\n  let isAuthorized = true; // Initially\n  const user = useAuthUserOrNull();\n\n  if (!user?.superUser) {\n    if (props.requiredPermissions) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching permission\n      for (const permission of props.requiredPermissions) {\n        if (user?.permissions?.find(({ key }) => key === permission)) {\n          isAuthorized = true;\n        }\n      }\n    }\n\n    if (props.requiredRoles) {\n      isAuthorized = false; // Reset - we are going to check that the user has at least one matching role\n      for (const role of props.requiredRoles) {\n        if (user?.roles?.find(({ key }) => key === role)) {\n          isAuthorized = true;\n        }\n      }\n    }\n  }\n  if (typeof props.render === 'function') {\n    return <>{props.render(isAuthorized)}</>;\n  }\n\n  return isAuthorized ? <>{props.children}</> : null;\n};\n","import { useCallback, useMemo, useState } from 'react';\nimport { CheckoutDialog } from '@frontegg/js';\n\ninterface CheckoutDialogState {\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport interface CheckoutDialogHook {\n  showDialog: (plan: string) => void;\n  hideDialog: () => void;\n  open: boolean;\n  error: string | null;\n  success: boolean;\n}\n\nexport const useCheckoutDialog = (appName = 'default'): CheckoutDialogHook => {\n  const [{ open, error, success }, setState] = useState<CheckoutDialogState>({\n    open: false,\n    error: null,\n    success: false,\n  });\n\n  const handleError = useCallback((error: string) => {\n    setState({\n      open: true,\n      success: false,\n      error,\n    });\n  }, []);\n\n  const handleSuccess = useCallback(() => {\n    setState({\n      open: false,\n      success: true,\n      error: null,\n    });\n  }, []);\n\n  const showDialog = useCallback(\n    (plan: string) => {\n      CheckoutDialog.show(\n        {\n          plan,\n          onClose: hideDialog,\n          onError: handleError,\n          onSuccess: handleSuccess,\n        },\n        appName\n      );\n      setState({\n        open: true,\n        success: false,\n        error: null,\n      });\n    },\n    [appName]\n  );\n\n  const hideDialog = useCallback(() => {\n    CheckoutDialog.hide(appName);\n    setState({\n      open: false,\n      error: null,\n      success: false,\n    });\n  }, [appName]);\n\n  return useMemo(\n    () => ({\n      open,\n      showDialog,\n      hideDialog,\n      error,\n      success,\n    }),\n    [open, showDialog, hideDialog, error, success]\n  );\n};\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}