{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nconst _excluded = [\"authorizationUrl\"],\n  _excluded2 = [\"events\", \"url\"];\nimport { api, fetch } from '@frontegg/rest-api';\nimport { call, put, select, takeLatest, takeLeading } from 'redux-saga/effects';\nimport { refreshToken } from '../LoginState/saga';\nimport { actions } from '../reducer';\nimport { AuthenticationTypes } from '../../index';\nimport { UserVeirifedOriginTypes } from '../interfaces';\nexport function* loadSocialLoginsConfigurations() {\n  try {\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const socialLoginsConfig = yield call(api.auth.getSocialLoginProviders);\n    yield put(actions.setSocialLoginsState({\n      socialLoginsConfig,\n      loading: false,\n      firstLoad: false\n    }));\n  } catch (e) {\n    yield put(actions.setSocialLoginsState({\n      error: e.message,\n      loading: false,\n      firstLoad: false\n    }));\n  }\n}\nexport function* loadSocialLoginsConfigurationsV2() {\n  try {\n    const context = yield select(state => state.root.context);\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const socialLoginsConfigV2 = yield call(api.auth.getSocialLoginProvidersV2);\n    const socialLoginsConfigWithFullUrl = socialLoginsConfigV2.map(_ref => {\n      let {\n          authorizationUrl\n        } = _ref,\n        config = _objectWithoutPropertiesLoose(_ref, _excluded);\n      const baseUrl = fetch.getBaseUrl(context, authorizationUrl != null ? authorizationUrl : '');\n      return _extends({}, config, {\n        authorizationUrl: authorizationUrl ? `${baseUrl}${authorizationUrl}` : null\n      });\n    });\n    yield put(actions.setSocialLoginsState({\n      socialLoginsConfigV2: socialLoginsConfigWithFullUrl,\n      loading: false,\n      firstLoad: false\n    }));\n  } catch (e) {\n    yield put(actions.setSocialLoginsState({\n      error: e.message,\n      loading: false,\n      firstLoad: false\n    }));\n  }\n}\nfunction* loginViaSocialLogin(_ref2) {\n  let {\n      payload: {\n        events,\n        url\n      }\n    } = _ref2,\n    payload = _objectWithoutPropertiesLoose(_ref2.payload, _excluded2);\n  try {\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const {\n      email,\n      isNewUser,\n      userId,\n      tenantId,\n      name\n    } = yield call(api.auth.loginViaSocialLogin, payload);\n    if (isNewUser) {\n      var _events$signUpComplet, _events$userVerified;\n      events == null ? void 0 : (_events$signUpComplet = events.signUpComplete) == null ? void 0 : _events$signUpComplet.call(events, {\n        email,\n        url,\n        authenticationType: AuthenticationTypes.SOCIAL_LOGIN,\n        createdAt: new Date(),\n        id: userId,\n        socialProvider: payload.provider,\n        tenantId\n      });\n      events == null ? void 0 : (_events$userVerified = events.userVerified) == null ? void 0 : _events$userVerified.call(events, {\n        email,\n        origin: UserVeirifedOriginTypes.SOCIAL_LOGIN,\n        createdAt: new Date(),\n        id: userId,\n        url,\n        tenantId,\n        name\n      });\n    }\n    if (userId) {\n      localStorage.setItem('userId', userId);\n    }\n    yield put(actions.setLoginState({\n      email,\n      isNewUser\n    }));\n    yield refreshToken();\n    localStorage.removeItem('register-quick-login');\n    yield put(actions.setSocialLoginsState({\n      loading: false\n    }));\n  } catch (e) {\n    var _e$message;\n    yield put(actions.setSocialLoginsState({\n      loading: false,\n      error: (_e$message = e.message) != null ? _e$message : 'Failed to authenticate',\n      firstLoad: false\n    }));\n  }\n}\nfunction setSocialLoginError(_ref3) {\n  let {\n    payload\n  } = _ref3;\n  return function* () {\n    yield put(actions.setSocialLoginsState({\n      error: payload.error,\n      loading: false,\n      firstLoad: false\n    }));\n  }();\n}\nexport function* socialLoginsSaga() {\n  yield takeLeading(actions.loadSocialLoginsConfiguration, loadSocialLoginsConfigurations);\n  yield takeLeading(actions.loadSocialLoginsConfigurationV2, loadSocialLoginsConfigurationsV2);\n  yield takeLeading(actions.loginViaSocialLogin, loginViaSocialLogin);\n  yield takeLatest(actions.setSocialLoginError, setSocialLoginError);\n}","map":{"version":3,"names":["_extends","_objectWithoutPropertiesLoose","_excluded","_excluded2","api","fetch","call","put","select","takeLatest","takeLeading","refreshToken","actions","AuthenticationTypes","UserVeirifedOriginTypes","loadSocialLoginsConfigurations","setSocialLoginsState","loading","socialLoginsConfig","auth","getSocialLoginProviders","firstLoad","e","error","message","loadSocialLoginsConfigurationsV2","context","state","root","socialLoginsConfigV2","getSocialLoginProvidersV2","socialLoginsConfigWithFullUrl","map","_ref","authorizationUrl","config","baseUrl","getBaseUrl","loginViaSocialLogin","_ref2","payload","events","url","email","isNewUser","userId","tenantId","name","_events$signUpComplet","_events$userVerified","signUpComplete","authenticationType","SOCIAL_LOGIN","createdAt","Date","id","socialProvider","provider","userVerified","origin","localStorage","setItem","setLoginState","removeItem","_e$message","setSocialLoginError","socialLoginsSaga","loadSocialLoginsConfiguration","loadSocialLoginsConfigurationV2"],"sources":["/Users/sagiittah/Downloads/my-app/node_modules/@frontegg/redux-store/auth/SocialLogins/saga.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nconst _excluded = [\"authorizationUrl\"],\n      _excluded2 = [\"events\", \"url\"];\nimport { api, fetch } from '@frontegg/rest-api';\nimport { call, put, select, takeLatest, takeLeading } from 'redux-saga/effects';\nimport { refreshToken } from '../LoginState/saga';\nimport { actions } from '../reducer';\nimport { AuthenticationTypes } from '../../index';\nimport { UserVeirifedOriginTypes } from '../interfaces';\nexport function* loadSocialLoginsConfigurations() {\n  try {\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const socialLoginsConfig = yield call(api.auth.getSocialLoginProviders);\n    yield put(actions.setSocialLoginsState({\n      socialLoginsConfig,\n      loading: false,\n      firstLoad: false\n    }));\n  } catch (e) {\n    yield put(actions.setSocialLoginsState({\n      error: e.message,\n      loading: false,\n      firstLoad: false\n    }));\n  }\n}\nexport function* loadSocialLoginsConfigurationsV2() {\n  try {\n    const context = yield select(state => state.root.context);\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const socialLoginsConfigV2 = yield call(api.auth.getSocialLoginProvidersV2);\n    const socialLoginsConfigWithFullUrl = socialLoginsConfigV2.map(_ref => {\n      let {\n        authorizationUrl\n      } = _ref,\n          config = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n      const baseUrl = fetch.getBaseUrl(context, authorizationUrl != null ? authorizationUrl : '');\n      return _extends({}, config, {\n        authorizationUrl: authorizationUrl ? `${baseUrl}${authorizationUrl}` : null\n      });\n    });\n    yield put(actions.setSocialLoginsState({\n      socialLoginsConfigV2: socialLoginsConfigWithFullUrl,\n      loading: false,\n      firstLoad: false\n    }));\n  } catch (e) {\n    yield put(actions.setSocialLoginsState({\n      error: e.message,\n      loading: false,\n      firstLoad: false\n    }));\n  }\n}\n\nfunction* loginViaSocialLogin(_ref2) {\n  let {\n    payload: {\n      events,\n      url\n    }\n  } = _ref2,\n      payload = _objectWithoutPropertiesLoose(_ref2.payload, _excluded2);\n\n  try {\n    yield put(actions.setSocialLoginsState({\n      loading: true\n    }));\n    const {\n      email,\n      isNewUser,\n      userId,\n      tenantId,\n      name\n    } = yield call(api.auth.loginViaSocialLogin, payload);\n\n    if (isNewUser) {\n      var _events$signUpComplet, _events$userVerified;\n\n      events == null ? void 0 : (_events$signUpComplet = events.signUpComplete) == null ? void 0 : _events$signUpComplet.call(events, {\n        email,\n        url,\n        authenticationType: AuthenticationTypes.SOCIAL_LOGIN,\n        createdAt: new Date(),\n        id: userId,\n        socialProvider: payload.provider,\n        tenantId\n      });\n      events == null ? void 0 : (_events$userVerified = events.userVerified) == null ? void 0 : _events$userVerified.call(events, {\n        email,\n        origin: UserVeirifedOriginTypes.SOCIAL_LOGIN,\n        createdAt: new Date(),\n        id: userId,\n        url,\n        tenantId,\n        name\n      });\n    }\n\n    if (userId) {\n      localStorage.setItem('userId', userId);\n    }\n\n    yield put(actions.setLoginState({\n      email,\n      isNewUser\n    }));\n    yield refreshToken();\n    localStorage.removeItem('register-quick-login');\n    yield put(actions.setSocialLoginsState({\n      loading: false\n    }));\n  } catch (e) {\n    var _e$message;\n\n    yield put(actions.setSocialLoginsState({\n      loading: false,\n      error: (_e$message = e.message) != null ? _e$message : 'Failed to authenticate',\n      firstLoad: false\n    }));\n  }\n}\n\nfunction* setSocialLoginError({\n  payload\n}) {\n  yield put(actions.setSocialLoginsState({\n    error: payload.error,\n    loading: false,\n    firstLoad: false\n  }));\n}\n\nexport function* socialLoginsSaga() {\n  yield takeLeading(actions.loadSocialLoginsConfiguration, loadSocialLoginsConfigurations);\n  yield takeLeading(actions.loadSocialLoginsConfigurationV2, loadSocialLoginsConfigurationsV2);\n  yield takeLeading(actions.loginViaSocialLogin, loginViaSocialLogin);\n  yield takeLatest(actions.setSocialLoginError, setSocialLoginError);\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}